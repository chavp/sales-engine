(function(){angular.module("salesHubApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,r){e.when("/",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/home",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});r.html5Mode({enabled:true,requireBase:false})}angular.module("salesHubApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","accounts",function(e,r,o){if(!o.isLoggedIn()){event.preventDefault();r.path("/")}}])})();(function(){angular.module("salesHubApp").controller("homeCtrl",e);e.$inject=["$scope","$location","accounts"];function e(e,r,o){var n=this;n.currentPath=r.path();n.message="Hello";n.doLogout=function(){o.logout();r.path("/")}}})();(function(){angular.module("salesHubApp").controller("loginCtrl",e);e.$inject=["$location","accounts"];function e(e,r){var o=this;o.currentPath=e.path();o.message="TEST";o.credentials={username:"",password:""};o.errorEmail="";o.errorPassword="";o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";o.errorUsername="";o.errorPassword="";if(!o.credentials.username){o.errorUsername="Required"}if(!o.credentials.password){o.errorPassword="Required"}if(o.errorPassword||o.errorPassword){return false}o.doLogin()};o.doLogin=function(){o.formError="";r.login(o.credentials).error(function(e){o.formError=e.message}).then(function(){e.search("page",null);e.path("/home")})};if(r.isLoggedIn())e.path("/home")}})();(function(){var e="sales_hub_token";angular.module("salesHubApp").service("accounts",r);r.$inject=["$http","$window"];function r(r,o){var n=function(r){o.localStorage[e]=r};var t=function(){return o.localStorage[e]};var a=function(){var e=t();if(e){var r=JSON.parse(o.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var i=function(){if(a()){var e=t();var n=JSON.parse(o.atob(e.split(".")[1]));var i=n._id;r.get("/api/accounts/"+i,{headers:{Authorization:"Bearer "+e}}).success(function(e){return{email:e.email,name:e.username}})}};register=function(e){return r.post("/api/accounts/register",e).success(function(e){n(e.token)})};login=function(e){return r.post("/api/accounts/login",e).success(function(e){n(e.token)})};logout=function(){o.localStorage.removeItem(e)};return{currentUser:i,saveToken:n,getToken:t,isLoggedIn:a,register:register,login:login,logout:logout}}})();