(function(){window.angularFeaturesConf={home:false,forgtPassword:false,createAccount:false,searchLead:false};angular.module("salesHubApp",["ngRoute","ngSanitize","ngAnimate","ui.bootstrap","smart-table","yh.featureToggle"]).constant("config",{TOKEN_NAME:"sales_hub_token",EMPATY_DISPLAY:"Untitled",DEFAULT_PATH:"/leads"});function e(e,o){e.when("/",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/leads",{templateUrl:"/leads/leads.view.html",controller:"leadsCtrl",controllerAs:"vm"}).when("/leads/:leadId",{templateUrl:"/leads/leads.view.html",controller:"leadsCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode({enabled:true,requireBase:false})}angular.module("salesHubApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","$window","config","accounts",function(e,o,r,t,n){if(!n.isLoggedIn()){o.path("/")}else{if(o.path()==="/"){o.path(t.DEFAULT_PATH)}}}])})();(function(){angular.module("salesHubApp").controller("homeCtrl",e);e.$inject=["$scope","$location","accounts"];function e(e,o,r){var t=this;t.currentPath=o.path();t.message="Hello";t.doLogout=function(){r.logout();o.path("/")}}})();(function(){angular.module("salesHubApp").controller("loginCtrl",e);e.$inject=["$location","$window","featureToggle","config","accounts"];function e(e,o,r,t,n){var a=this;a.currentPath=e.path();a.forgtPassword=r.isEnabled("forgtPassword");a.createAccount=r.isEnabled("createAccount");a.message="TEST";a.credentials={username:"ding2@saleshub.com",password:"123456789"};a.errorEmail="";a.errorPassword="";a.returnPage=e.search().page||"/";a.onSubmit=function(){a.formError="";a.errorUsername="";a.errorPassword="";if(!a.credentials.username){a.errorUsername="Required"}if(!a.credentials.password){a.errorPassword="Required"}if(a.errorPassword||a.errorPassword){return false}a.doLogin()};a.doLogin=function(){a.formError="";n.login(a.credentials).error(function(e){a.formError=e.message}).then(function(e){o.location=t.DEFAULT_PATH})};if(n.isLoggedIn()){leftNavigationCtrl.isLoggedIn;e.path(t.DEFAULT_PATH)}}})();(function(){angular.module("salesHubApp").service("accounts",e);e.$inject=["$http","$window","config"];function e(e,o,r){var t=function(e){o.localStorage[r.TOKEN_NAME]=e};var n=function(){return o.localStorage[r.TOKEN_NAME]};var a=function(){var e=n();if(e){var r=JSON.parse(o.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var s=function(r){if(a()){var t=n();var s=JSON.parse(o.atob(t.split(".")[1]));var l=s._id;e.get("/api/accounts/"+l,{headers:{Authorization:"Bearer "+t}}).success(function(e){if(r){r(true,{email:e.email,name:e.profile.firstName+" "+e.profile.lastName,phone:e.profile.phone})}}).error(function(e){logout();r(false,e)})}};register=function(o){return e.post("/api/accounts/register",o).success(function(e){t(e.token)})};login=function(o){return e.post("/api/accounts/login",o).success(function(e){t(e.token)})};logout=function(){o.localStorage.removeItem(r.TOKEN_NAME)};return{getCurrentUser:s,saveToken:t,getToken:n,isLoggedIn:a,register:register,login:login,logout:logout}}})();