(function(){window.angularFeaturesConf={forgtPassword:false,createAccount:false,searchLead:false};angular.module("salesHubApp",["ngRoute","ngSanitize","ngAnimate","ui.bootstrap","smart-table","yh.featureToggle"]).constant("config",{TOKEN_NAME:"sales_hub_token"});function e(e,o){e.when("/",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/home",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/leads",{templateUrl:"/leads/leads.view.html",controller:"leadsCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode({enabled:true,requireBase:false})}angular.module("salesHubApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","$window","accounts",function(e,o,r,t){if(!t.isLoggedIn()){o.path("/")}else{if(o.path()==="/"){o.path("/home")}}}])})();(function(){angular.module("salesHubApp").controller("homeCtrl",e);e.$inject=["$scope","$location","accounts"];function e(e,o,r){var t=this;t.currentPath=o.path();t.message="Hello";t.doLogout=function(){r.logout();o.path("/")}}})();(function(){angular.module("salesHubApp").controller("loginCtrl",e);e.$inject=["$location","$window","featureToggle","accounts"];function e(e,o,r,t){var n=this;n.currentPath=e.path();n.forgtPassword=r.isEnabled("forgtPassword");n.createAccount=r.isEnabled("createAccount");n.message="TEST";n.credentials={username:"",password:""};n.errorEmail="";n.errorPassword="";n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";n.errorUsername="";n.errorPassword="";if(!n.credentials.username){n.errorUsername="Required"}if(!n.credentials.password){n.errorPassword="Required"}if(n.errorPassword||n.errorPassword){return false}n.doLogin()};n.doLogin=function(){n.formError="";t.login(n.credentials).error(function(e){n.formError=e.message}).then(function(e){o.location="/home"})};if(t.isLoggedIn()){leftNavigationCtrl.isLoggedIn;e.path("/home")}}})();(function(){angular.module("salesHubApp").service("accounts",e);e.$inject=["$http","$window","config"];function e(e,o,r){var t=function(e){o.localStorage[r.TOKEN_NAME]=e};var n=function(){return o.localStorage[r.TOKEN_NAME]};var a=function(){var e=n();if(e){var r=JSON.parse(o.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var s=function(r){if(a()){var t=n();var s=JSON.parse(o.atob(t.split(".")[1]));var i=s._id;e.get("/api/accounts/"+i,{headers:{Authorization:"Bearer "+t}}).success(function(e){if(r){r(true,{email:e.email,name:e.profile.firstName+" "+e.profile.lastName,phone:e.profile.phone})}}).error(function(e){logout();r(false,e)})}};register=function(o){return e.post("/api/accounts/register",o).success(function(e){t(e.token)})};login=function(o){return e.post("/api/accounts/login",o).success(function(e){t(e.token)})};logout=function(){o.localStorage.removeItem(r.TOKEN_NAME)};return{getCurrentUser:s,saveToken:t,getToken:n,isLoggedIn:a,register:register,login:login,logout:logout}}})();