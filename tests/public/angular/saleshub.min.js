(function(){window.angularFeaturesConf={home:false,forgtPassword:false,createAccount:false,searchLead:false};angular.module("salesHubApp",["ngRoute","ngSanitize","ngAnimate","ui.bootstrap","smart-table","angular-ladda","blockUI","ngTagsInput","ngFileUpload","angular-timeline","angular-scroll-animate","yh.featureToggle"]).constant("config",{TOKEN_NAME:"sales_hub_token",EMPATY_DISPLAY:"Untitled",DEFAULT_PATH:"/leads"});function e(e,r){e.when("/",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/leads",{templateUrl:"/leads/leads.view.html",controller:"leadsCtrl",controllerAs:"vm"}).when("/leads/:leadId",{templateUrl:"/leads/lead/lead.view.html",controller:"leadCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});r.html5Mode({enabled:true,requireBase:false})}angular.module("salesHubApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","$window","$timeout","$log","config","accounts",function(e,r,o,n,t,a,l){if(!l.isLoggedIn()){r.path("/")}else{if(r.path()==="/"){r.path(a.DEFAULT_PATH)}}n(function(){t.debug("Start app_client")},3e3)}]);angular.module("salesHubApp").directive("focus",function(e){return{scope:{trigger:"@focus"},link:function(r,o){r.$watch("trigger",function(r){if(r==="true"){e(function(){o[0].focus()})}})}}})})();(function(){angular.module("salesHubApp").controller("homeCtrl",e);e.$inject=["$scope","$location","accounts"];function e(e,r,o){var n=this;n.currentPath=r.path();n.message="Hello";n.doLogout=function(){o.logout();r.path("/")}}})();(function(){angular.module("salesHubApp").controller("loginCtrl",e);e.$inject=["$location","$window","$log","featureToggle","config","accounts"];function e(e,r,o,n,t,a){var l=this;l.currentPath=e.path();l.forgtPassword=n.isEnabled("forgtPassword");l.createAccount=n.isEnabled("createAccount");l.message="TEST";l.credentials={username:"my.parinya@gmail.com",password:"123456789"};l.errorEmail="";l.errorPassword="";l.returnPage=e.search().page||"/";l.onSubmit=function(){l.formError="";l.errorUsername="";l.errorPassword="";if(!l.credentials.username){l.errorUsername="Required"}if(!l.credentials.password){l.errorPassword="Required"}if(l.errorPassword||l.errorPassword){return false}l.doLogin()};l.doLogin=function(){l.formError="";l.loading=true;a.login(l.credentials).error(function(e){o.error(e);if(e){l.formError=e.message;l.loading=false;o.error(e)}}).then(function(e){r.location=t.DEFAULT_PATH})};if(a.isLoggedIn()){e.path(t.DEFAULT_PATH)}}})();(function(){angular.module("salesHubApp").service("accounts",e);e.$inject=["$http","$window","config"];function e(e,r,o){var n=function(e){r.localStorage[o.TOKEN_NAME]=e};var t=function(){return r.localStorage[o.TOKEN_NAME]};var a=function(){var e=t();if(e){var o=JSON.parse(r.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var l=function(o){if(a()){var n=t();var l=JSON.parse(r.atob(n.split(".")[1]));var i=l._id;e.get("/api/accounts/"+i,{headers:{Authorization:"Bearer "+n}}).success(function(e){if(o){o(null,{email:e.email,name:e.profile.firstName+" "+e.profile.lastName,shortName:e.profile.firstName,phone:e.profile.phone})}}).error(function(e){o(e,null)})}};register=function(r){return e.post("/api/accounts/register",r).success(function(e){n(e.token)})};login=function(r){return e.post("/api/accounts/login",r).success(function(e){n(e.token)})};logout=function(){r.localStorage.removeItem(o.TOKEN_NAME)};return{getCurrentUser:l,saveToken:n,getToken:t,isLoggedIn:a,register:register,login:login,logout:logout}}})();